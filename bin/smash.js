var k=void 0,p=!0,q=null,r=!1,ha=this;function ia(a,b){var c=a.split("."),d=ha;!(c[0]in d)&&d.execScript&&d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)!c.length&&b!==k?d[e]=b:d=d[e]?d[e]:d[e]={}}function ja(a){a.I=function(){return a.U?a.U:a.U=new a}}function s(a,b){function c(){}c.prototype=b.prototype;a.Ma=b.prototype;a.prototype=new c};function ka(){};function t(){this.K=this.c=q;this.v=0;this.Ia=this.ha=r;this.ka=q;this.ja=0;this.L=q;this.ma=0;this.sa=q;this.ra=0;this.da=q}t.prototype.bind=function(a){var b=this.c,c=u(),d=q,e=q;b.buffer&&b.buffer.bind();b.j.bind();for(var f=0,j=b.g.length;f<j;++f)d=b.g[f],e=a[d.name],e!=k&&(d.buffer!=q&&d.buffer.bind(),c.enableVertexAttribArray(e.id),c.vertexAttribPointer(e.id,d.count,d.type,d.normalize,d.size,d.offset))};
t.prototype.F=function(){this.c=new la;var a=0<this.ja,b=0<this.ra,c;c=16;a&&(c+=12);b&&(c+=8);this.ha?(this.da=new ArrayBuffer(c),a=this.c,b=this.da,c=this.K,a.buffer=new v,a.buffer.fill(b),a.j.fill(c),a.j.type=5121):(c=this.c,c.j.fill(this.K),c.j.type=5121,this.c.add("aPosition",3,5126,0,12,this.L),this.c.add("aColor",4,5121,0,4,this.L),b&&this.c.add("Texture",2,5126,0,8,this.sa),a&&this.c.add("Normal",3,5126,0,12,this.ka))};t.prototype.update=function(){};function w(a){this.length=a.length||a;for(var b=0;b<this.length;b++)this[b]=a[b]||0}w.prototype.BYTES_PER_ELEMENT=8;w.prototype.set=function(a,b){b=b||0;for(var c=0;c<a.length&&b+c<this.length;c++)this[b+c]=a[c]};w.prototype.toString=Array.prototype.join;if("undefined"==typeof Float64Array){try{w.BYTES_PER_ELEMENT=8}catch(ma){}w.prototype.BYTES_PER_ELEMENT=w.prototype.BYTES_PER_ELEMENT;w.prototype.set=w.prototype.set;w.prototype.toString=w.prototype.toString;ia("Float64Array",w)};function x(a){this.length=a.length||a;for(var b=0;b<this.length;b++)this[b]=a[b]||0}x.prototype.BYTES_PER_ELEMENT=4;x.prototype.set=function(a,b){b=b||0;for(var c=0;c<a.length&&b+c<this.length;c++)this[b+c]=a[c]};x.prototype.toString=Array.prototype.join;"undefined"==typeof Float32Array&&(x.BYTES_PER_ELEMENT=4,x.prototype.BYTES_PER_ELEMENT=x.prototype.BYTES_PER_ELEMENT,x.prototype.set=x.prototype.set,x.prototype.toString=x.prototype.toString,ia("Float32Array",x));function oa(a,b){var c=new Float32Array(3);y(c,a,1,b);return c}function y(a,b,c,d){a[0]=b;a[1]=c;a[2]=d}function pa(a,b){var c=a[0],d=a[1],e=a[2],c=1/Math.sqrt(c*c+d*d+e*e);b[0]=a[0]*c;b[1]=a[1]*c;b[2]=a[2]*c}function qa(a,b,c){var d=a[0],e=a[1];a=a[2];var f=b[0],j=b[1];b=b[2];c[0]=e*b-a*j;c[1]=a*f-d*b;c[2]=d*j-e*f};function z(){return new Float32Array(16)}function ra(a,b,c,d,e,f,j,n,m,l,h,g,A,B,C,D,E){a[0]=b;a[1]=c;a[2]=d;a[3]=e;a[4]=f;a[5]=j;a[6]=n;a[7]=m;a[8]=l;a[9]=h;a[10]=g;a[11]=A;a[12]=B;a[13]=C;a[14]=D;a[15]=E;return a}function sa(a,b,c){a[b]=c[0];a[b+4]=c[1];a[b+8]=c[2];a[b+12]=c[3]}function ta(a,b,c,d){var e=a[1]*b+a[5]*c+a[9]*d+a[13],f=a[2]*b+a[6]*c+a[10]*d+a[14],j=a[3]*b+a[7]*c+a[11]*d+a[15];a[12]=a[0]*b+a[4]*c+a[8]*d+a[12];a[13]=e;a[14]=f;a[15]=j}
function ua(a,b,c,d){ra(a,a[0]*b,a[1]*b,a[2]*b,a[3]*b,a[4]*c,a[5]*c,a[6]*c,a[7]*c,a[8]*d,a[9]*d,a[10]*d,a[11]*d,a[12],a[13],a[14],a[15])}function va(a,b){var c=a[4],d=a[5],e=a[6],f=a[7],j=a[8],n=a[9],m=a[10],l=a[11],h=Math.cos(b),g=Math.sin(b);a[4]=c*h+j*g;a[5]=d*h+n*g;a[6]=e*h+m*g;a[7]=f*h+l*g;a[8]=c*-g+j*h;a[9]=d*-g+n*h;a[10]=e*-g+m*h;a[11]=f*-g+l*h}
function wa(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],j=a[8],n=a[9],m=a[10],l=a[11],h=Math.cos(b),g=Math.sin(b);a[0]=c*h+j*-g;a[1]=d*h+n*-g;a[2]=e*h+m*-g;a[3]=f*h+l*-g;a[8]=c*g+j*h;a[9]=d*g+n*h;a[10]=e*g+m*h;a[11]=f*g+l*h}function xa(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],j=a[4],n=a[5],m=a[6],l=a[7],h=Math.cos(b),g=Math.sin(b);a[0]=c*h+j*g;a[1]=d*h+n*g;a[2]=e*h+m*g;a[3]=f*h+l*g;a[4]=c*-g+j*h;a[5]=d*-g+n*h;a[6]=e*-g+m*h;a[7]=f*-g+l*h}new Float64Array(3);new Float64Array(3);
var ya=[new Float64Array(4),new Float64Array(4),new Float64Array(4)];new Float64Array(16);function F(){var a=z();a[0]=a[5]=a[10]=a[15]=1;this.b=a;this.position=new Float32Array(3);this.rotation=new Float32Array(3);this.scale=oa(1,1);this.f=p}
F.prototype.J=function(){if(this.f){var a=this.b,b=this.position[0],c=this.position[1],d=this.position[2];a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;a[12]=b;a[13]=c;a[14]=d;a[15]=1;ua(this.b,this.scale[0],this.scale[1],this.scale[2]);va(this.b,this.rotation[0]);wa(this.b,this.rotation[1]);xa(this.b,this.rotation[2]);this.f=r}return this.b};function G(a){this.parent=q;this.children=[];this.G=0;this.B=a||new F}G.prototype.add=function(a){this.children[this.G]=a;this.G++};function za(a){window.console.error("Nucleus log: "+a)};function H(a){this.id=u().createShader(a);this.A=r}H.prototype.fill=function(a){var b=u();b.shaderSource(this.id,a);b.compileShader(this.id);this.A=p};H.prototype.clear=function(){u().deleteShader(this.id)};function Aa(a){if(5124!=a){if(5126==a)return"float";if(35664==a)return"vec2";if(35665==a)return"vec3";if(35666==a)return"vec4";if(3==a)return"sampler2D";if(1==a)return"mat3";if(0==a)return"mat4";if(35670==a)return"bool"}return"int"};function Ba(){this.id=-1;this.count=1;this.data=0;this.elements=new I;this.ia=5126;this.normalize=r;this.precision="lowp"};function I(){this.elements=[];this.R=0}I.prototype.add=function(a,b,c,d,e){var f=new Ba;f.type=c;f.count=b;f.precision=d||"lowp";f.ia=e||5126;this.elements[a]=f;this.R++};function J(a){this.P=new I;this.S="";this.Fa=[];this.a=a||new K;this.p=[];this.$=new I;this.Pa=this.ba=this.aa=p;this.ca=""}J.prototype.h=function(a,b,c,d){this.P.add(a,b,c,d);this.a.h(a,c)};J.prototype.e=function(a,b,c,d,e){this.$.add(a,c,d,e);b?(b=this.a,b.r[a]=b.e(d)):(b=this.a,b.w[a]=b.e(d))};function Ca(a){var b=L("Main"),b=b+"void main() \n{ \n ",b=b+(a+"\n");return b+="} \n "}
function L(a){var b;b="\n////////////////////////////////// \n";b+="/// "+(a.charAt(0).toUpperCase()+a.slice(1))+".\n";return b+="////////////////////////////////// \n"}function Da(a,b,c){var d=Aa(b.type),e="",e=c==k||c==p?a:"v"+a.substring(1);return b.precision+" "+d+" "+e+";"}function Ea(a,b){var c=b==r?"attribute":"varying",d=L(c+"s"),e=a.P.elements,f;for(f in e)d+=c+" "+Da(f,e[f],!b)+"\n";return d}
J.prototype.create=function(){this.a==q&&za("ProgramBuilder can't generate the given program.");var a="",b="";if(this.ba){var c=new I;c.add("ambient",1,35665);c.add("diffuse",1,35666);c.add("specular",1,35665);c.add("shininess",1,5126);this.p.Material=c}this.aa&&(c=new I,c.add("position",1,35665),c.add("direction",1,35665),c.add("color",1,35665),this.p.Light=c);this.a==q&&za("Program is null, ProgramBuilder can't add default uniforms.");this.e("uMvp",p,1,0,"mediump");this.e("uModel",r,1,0,"mediump");
this.e("uAmbientLight",p,1,35665);this.ba&&this.e("uMaterial",r,1,12);this.aa&&this.e("uLight",p,1,12);this.h("aPosition",3,35665);this.h("aColor",4,35666);this.h("aTexCoord",2,35664);this.h("aNormal",3,35665);var d,c="";for(d in this.p){var c=c+L(d+" structure"),c=c+("struct "+d+"\n"),c=c+"{\n",e;for(e in this.p[d].elements)c+="\t"+Da(e,this.p[d].elements[e])+"\n";c+="};\n"}d=c;var a=a+d,b=b+d,f;d=L("Uniforms");e=q;var c="",j=this.$.elements;for(f in j)c=1<j[f].count?"["+j[f].count+"]":"",e=12==
j[f].type?f.substr(1):j[f].precision+" "+Aa(j[f].type),d+="uniform "+e+" "+f+c+"; \n";f=d;b+=f;a=a+f+Ea(this,r);a+=Ea(this,p);b+=Ea(this,p);b+=Ca(this.S);a+=Ca(this.ca);f=this.a;f.s.fill(b);f.C.fill(a);f.F();return this.a};function Fa(){this.z=[]}ja(Fa);Fa.prototype.W=function(a,b){this.z[a]=b};function M(){var a=new Float32Array(4);a[0]=1;a[1]=1;a[2]=1;a[3]=1;this.value=a};function Ga(){this.ua=new M;this.xa=Ha;this.Ca=new M;this.ga=Ia;var a=Fa.I();if(a.z["default"]==k){var b;b="vColor\t\t  = aColor; \ngl_Position   = (uMvp * uModel) * vec4( aPosition, 1.0);";var c=new J;c.ca=b;c.S="gl_FragColor  = vColor;";a.z["default"]=c.create()}this.a=a.z["default"];this.Ka=5;this.La=new M;this.Z=q;this.visible=p}var Ha=3,Ia=4;function Ja(a,b){G.call(this);this.d=a;this.V=b}s(Ja,G);function Ka(a){F.call(this);this.ea=z();this.M=z();this.Ja=new Float32Array(9);this.ta=oa(0,0);this.viewport={x:0,y:0,width:800,height:600};La(this);switch(a){case "2D":a=z();this.M=ra(a,1,0,0,0,0,1,0,0,0,0,-2/99,0,-0,-0,-101/99,1);break;default:a=this.viewport.width/this.viewport.height;var b=z(),c=Math.sin(22.5);0==c||0==a?a=b:(c=Math.cos(22.5)/c,a=ra(b,c/a,0,0,0,0,c,0,0,0,0,-101/99,-1,0,0,-200/99,0));this.M=a}}s(Ka,F);
function La(a){var b=z(),c=a.position,d=a.ta,e=ya[0],f=[0,0,-5];e[0]=f[0]-c[0];e[1]=f[1]-c[1];e[2]=f[2]-c[2];pa(e,e);e[3]=0;f=ya[1];qa(e,d,f);pa(f,f);f[3]=0;d=ya[2];qa(f,e,d);pa(d,d);d[3]=0;e[0]=-e[0];e[1]=-e[1];e[2]=-e[2];sa(b,0,f);sa(b,1,d);sa(b,2,e);b[3]=0;b[7]=0;b[11]=0;b[15]=1;ta(b,-c[0],-c[1],-c[2]);a.ea=b}
Ka.prototype.J=function(){if(this.f){var a=this.ea,b=z();b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];this.b=b;ta(this.b,this.position[0],this.position[1],this.position[2]);ua(this.b,this.scale[0],this.scale[1],this.scale[2]);va(this.b,this.rotation[0]);wa(this.b,this.rotation[1]);xa(this.b,this.rotation[2]);var c=this.M,d=this.b,a=this.b,b=c[0],e=c[1],f=c[2],j=c[3],n=c[4],
m=c[5],l=c[6],h=c[7],g=c[8],A=c[9],B=c[10],C=c[11],D=c[12],E=c[13],S=c[14],c=c[15],T=d[0],U=d[1],V=d[2],W=d[3],X=d[4],Y=d[5],Z=d[6],$=d[7],aa=d[8],ba=d[9],ca=d[10],da=d[11],ea=d[12],fa=d[13],ga=d[14],d=d[15];a[0]=b*T+n*U+g*V+D*W;a[1]=e*T+m*U+A*V+E*W;a[2]=f*T+l*U+B*V+S*W;a[3]=j*T+h*U+C*V+c*W;a[4]=b*X+n*Y+g*Z+D*$;a[5]=e*X+m*Y+A*Z+E*$;a[6]=f*X+l*Y+B*Z+S*$;a[7]=j*X+h*Y+C*Z+c*$;a[8]=b*aa+n*ba+g*ca+D*da;a[9]=e*aa+m*ba+A*ca+E*da;a[10]=f*aa+l*ba+B*ca+S*da;a[11]=j*aa+h*ba+C*ca+c*da;a[12]=b*ea+n*fa+g*ga+D*
d;a[13]=e*ea+m*fa+A*ga+E*d;a[14]=f*ea+l*fa+B*ga+S*d;a[15]=j*ea+h*fa+C*ga+c*d;this.f=r}return this.b};function Ma(){G.call(this);this.color=new M;this.direction=oa(1,1);this.wa=new M;this.ya=p}s(Ma,G);function Na(){Ma.call(this)}s(Na,Ma);function Oa(){G.call(this);this.va=new Na;this.Ga=[];this.Ha=0}s(Oa,G);function Pa(a){this.Ba=[];this.D=a};function Qa(a){this.Da=0;this.D=a};function Ra(a){this.qa=[];this.oa=0;this.D=a}Ra.prototype.update=function(){for(var a=0,b=this.oa;a<b;++a)this.qa[a].update()};function Sa(){this.Aa=new Pa(this);this.Ea=new Qa(this);this.pa=new Ra(this)}Sa.prototype.update=function(){this.pa.update()};function Ta(){this.D=new Sa;this.q=new Ka("3D");this.n=q;this.Y=new Oa}Ta.prototype.N=function(a){a.N(this.Y,this.q)};
Ta.prototype.start=function(){var a=this.q;y(a.position,0,0,2);a.f=p;La(this.q);a=this.q;y(a.position,0,0,0);a.f=p;var a=new t,b=[0.5,-0.5,0,0.5,0.5,0,-0.5,0.5,0,-0.5,-0.5,0];a.L=new Float32Array(b);a.ma=b.length;b=[0,1,2,2,3,0];a.v=b.length;a.K=255>a.v?new Uint8Array(b):65535>a.v?new Uint16Array(b):new Uint32Array(b);a.F();this.n=new Ja(a,new Ga);a=this.n.B;y(a.scale,1,1,1);a.f=p;this.Y.add(this.n)};
Ta.prototype.update=function(){this.D.update();var a=this.n.B.rotation,b=this.n.B;y(b.rotation,a[0],a[1],a[2]+0.01);b.f=p};window.na=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)};function Ua(){}Ua.prototype.create=function(a){var b=q;try{var c={premultipliedAlpha:r,alpha:r},b=a.getContext("webgl",c)||a.getContext("experimental-webgl",c)}catch(d){}b===q&&alert("Missing context");return b};function N(){this.fa=new Ua;this.Q=[];this.H=q}ja(N);function u(){return N.I().H}N.prototype.create=function(a){a=this.fa.create(a);this.W(a);this.H==q&&(this.H=a);return a};N.prototype.W=function(a){this.Q[this.Q.length]=a};function O(){this.data=q;this.height=this.width=0;this.A=r;this.za=q}O.prototype.t=function(){return this.height};O.prototype.u=function(){return this.width};O.prototype.getData=function(){return this.data};function Va(){O.call(this);this.data=new Image}s(Va,O);function P(a){a=a||u();this.id=a.createTexture();this.source=q}P.prototype.bind=function(){u().bindTexture(3553,this.id)};P.prototype.create=function(a,b){var c=u(),d;d=new Va;d=this.source=d;d.width=a;d.height=b;this.bind();d=u();d.texParameteri(3553,10241,9985);d.texParameteri(3553,10240,9729);this.source.u()==this.source.t()&&u().generateMipmap(3553);c.texImage2D(3553,0,6408,a,b,0,6408,5121,q);u().bindTexture(3553,q)};
P.prototype.fill=function(a){var b=u();this.bind();b.texImage2D(3553,0,6408,6408,5121,a)};P.prototype.update=function(){this.fill(this.source.getData())};P.prototype.t=function(){return this.source.t()};P.prototype.u=function(){return this.source.u()};function Wa(a){this.la=a}Wa.prototype.create=function(){return new P(this.la)};function Xa(){this.data=0;this.id=-1;this.type=5126};function Ya(){this.id=-1};function K(){this.g=[];this.r=[];this.s=new H(35632);this.id=u().createProgram();this.w=[];this.C=new H(35633)}K.prototype.h=function(a){this.g[a]=new Ya};K.prototype.e=function(a){var b=new Xa;b.type=a;return b};K.prototype.bind=function(){u().useProgram(this.id)};
K.prototype.F=function(){if(!(this.s.A==r||this.C.A==r)){var a=u();a.attachShader(this.id,this.C.id);a.attachShader(this.id,this.s.id);a.linkProgram(this.id);this.C.clear();this.s.clear();if(a.getProgramParameter(this.id,35714)){var a=u(),b=this.g,c;for(c in b)b[c].id=a.getAttribLocation(this.id,c);Za(this,this.r);Za(this,this.w)}else za("Error found during shader compilation.")}};function Za(a,b){var c=u(),d;for(d in b)b[d].id=c.getUniformLocation(a.id,d),b[d].id==q&&(b[d].id=-1)}
function $a(a){var b=u(),c;for(c in a)-1!=a[c].id&&(0==a[c].type?b.uniformMatrix4fv(a[c].id,a[c].normalize,a[c].data):1==a[c].type?b.uniformMatrix3fv(a[c].id,a[c].normalize,a[c].data):35665==a[c].type?b.uniform3fv(a[c].id,a[c].data):8==a[c].type?b.uniform1iv(a[c].id,a[c].data):5126==a[c].type?b.uniform1f(a[c].id,a[c].data):(3==a[c].type||5124==a[c].type)&&b.uniform1i(a[c].id,a[c].data))};function Q(){this.id=q;this.R=0;this.i=u()}Q.prototype.bind=function(){};Q.prototype.fill=function(){};function ab(){Q.call(this);this.id=this.i.createBuffer();this.type=5121}s(ab,Q);ab.prototype.bind=function(){this.i.bindBuffer(34963,this.id)};ab.prototype.fill=function(a){this.bind();this.i.bufferData(34963,a,35044)};function bb(){this.buffer=q;this.name="";this.normalize=r;this.size=this.offset=0;this.type=5126;this.Oa=r}bb.prototype.o=function(a,b,c,d,e,f){d!=k&&f!=k&&(this.buffer=new v,this.buffer.fill(f));this.count=b;this.name=a;this.offset=d||this.offset;this.type=c||this.type;this.size=e||this.size};function v(){Q.call(this);this.id=this.i.createBuffer()}s(v,Q);v.prototype.bind=function(){this.i.bindBuffer(34962,this.id)};v.prototype.fill=function(a){this.bind();this.i.bufferData(34962,a,35044)};function la(){this.Qa=new v;this.j=new ab;this.g=[];this.O=0}s(la,ka);la.prototype.add=function(a,b,c,d,e,f){var j=new bb;j.o(a,b,c,d,e,f);this.g[this.O]=j;this.O++};function cb(){this.Z=this.a=this.T=this.d=q}cb.prototype.clear=function(){this.d=this.Z=this.a=q};cb.prototype.useProgram=function(a,b){a!=this.a&&(this.a=a,this.a.bind(),this.a.r.uMvp.data=b.J(),$a(this.a.r))};function db(a){this.k=N.I().create(a);this.Na=new Wa(this.k);this.m=new cb}db.prototype.N=function(a,b){this.k.clearColor(0.2,0.2,0.2,1);this.k.clear(16640);this.k.viewport(b.viewport.x,b.viewport.y,b.viewport.width,b.viewport.height);eb(this,b,a,a.children);this.m.clear()};
function eb(a,b,c,d){var e=0;for(c=c.G;e<c;++e){var f=a,j=b,n=d[e],m=f,l=n;if(!(l.V==q||l.d==q)){var h=l.V,g=h.a;m.m.useProgram(g,j);g.w.uModel.data=l.B.J();$a(g.w);g=m.m;l=l.d;l!=g.d&&(g.d=l,g.T=g.d.c,g.d.bind(g.a.g));m.k.drawElements(h.ga,m.m.d.v,m.m.T.j.type,0)}eb(f,j,n,n.children)}}db.prototype.t=function(){return 0};db.prototype.u=function(){return 0};function R(){this.X=this.l=q}R.prototype.o=function(){};R.prototype.start=function(){this.update()};R.prototype.update=function(){window.na(this.update.bind(this));this.l!=q&&(this.l.update(this),this.l.N(this.X))};R.prototype.clear=function(){this.o()};function fb(){R.call(this)}s(fb,R);fb.prototype.o=function(){this.l=new Ta;this.X=new db(document.getElementById("test"));this.l.start(this)};window.application=function(){var a=new fb;a.o();a.start()};
